/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */

define("models/discovery_card_model",["backbone","underscore"],function(e){return e.Model.extend({})}),define("models/discovery_card_collection",["backbone","underscore","models/discovery_card_model"],function(e,t,i){return e.Collection.extend({urlRoot:"/api/discovery/v1/cards",model:i,limitDefault:30,initialize:function(e,t){this.queryData=t.queryData,this.setUrl()},formatQuery:function(){return"?"+this.getQueries(this.queryData)},getMore:function(e){this.queryData.offset=e,this.setUrl(),this.fetch()},getMultipleAttrQueries:function(e){var i=[];return t.each(e,function(e){i.push(encodeURIComponent(e))}),i.join("%20")},getQueries:function(e){var i=[];return t.each(e,function(e,t){e&&e.length>0?i.push(t+"="+this.getMultipleAttrQueries(e)):e&&i.push(t+"="+encodeURIComponent(e))},this),i.join("&")},setUrl:function(){this.url=this.urlRoot+this.formatQuery()}})}),define("models/discovery_card_course_run_collection",["models/discovery_card_collection"],function(e){return e.extend({urlRoot:"/api/discovery/v1/course_run_cards"})}),define("text",["module"],function(e){var t,i,n,r,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,u=c&&location.protocol&&location.protocol.replace(/\:/,""),d=c&&location.hostname,h=c&&(location.port||void 0),f={},p=e.config&&e.config()||{};return t={version:"2.0.12",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){i=o[t];try{e=new ActiveXObject(i)}catch(n){}if(e){o=[i];break}}return e},parseName:function(e){var t,i,n,r=!1,s=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==s&&(!o||s>1)?(t=e.substring(0,s),i=e.substring(s+1,e.length)):t=e,n=i||t,s=n.indexOf("!"),-1!==s&&(r="strip"===n.substring(s+1),n=n.substring(0,s),i?i=n:t=n),{moduleName:t,ext:i,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,r){var s,o,a,l=t.xdRegExp.exec(e);return l?(s=l[2],o=l[3],o=o.split(":"),a=o[1],o=o[0],!(s&&s!==i||o&&o.toLowerCase()!==n.toLowerCase()||(a||o)&&a!==r)):!0},finishLoad:function(e,i,n,r){n=i?t.strip(n):n,p.isBuild&&(f[e]=n),r(n)},load:function(e,i,n,r){if(r&&r.isBuild&&!r.inlineText)return void n();p.isBuild=r&&r.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),a=i.toUrl(o),l=p.useXhr||t.useXhr;return 0===a.indexOf("empty:")?void n():void(!c||l(a,u,d,h)?t.get(a,function(i){t.finishLoad(e,s.strip,i,n)},function(e){n.error&&n.error(e)}):i([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,n)}))},write:function(e,i,n){if(f.hasOwnProperty(i)){var r=t.jsEscape(f[i]);n.asModule(e+"!"+i,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,i,n,r,s){var o=t.parseName(i),a=o.ext?"."+o.ext:"",l=o.moduleName+a,c=n.toUrl(o.moduleName+a)+".js";t.load(l,n,function(){var i=function(e){return r(c,e)};i.asModule=function(e,t){return r.asModule(e,c,t)},t.write(e,l,i,s)},s)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(i=require.nodeRequire("fs"),t.get=function(e,t,n){try{var r=i.readFileSync(e,"utf8");0===r.indexOf("ï»¿")&&(r=r.substring(1)),t(r)}catch(s){n&&n(s)}}):"xhr"===p.env||!p.env&&t.createXhr()?t.get=function(e,i,n,r){var s,o=t.createXhr();if(o.open("GET",e,!0),r)for(s in r)r.hasOwnProperty(s)&&o.setRequestHeader(s.toLowerCase(),r[s]);p.onXhr&&p.onXhr(o,e),o.onreadystatechange=function(){var t,r;4===o.readyState&&(t=o.status||0,t>399&&600>t?(r=new Error(e+" HTTP status: "+t),r.xhr=o,n&&n(r)):i(o.responseText),p.onXhrComplete&&p.onXhrComplete(o,e))},o.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,r="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),r)),l="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(o),i.append(n);l=String(i.toString())}finally{a.close()}t(l)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,r=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in n,t.get=function(e,t){var i,o,a,l={};s&&(e=e.replace(/\//g,"\\")),a=new FileUtils.File(e);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream),i.init(a,1,0,!1),o=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream),o.init(i,"utf-8",i.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(i.available(),l),o.close(),i.close(),t(l.value)}catch(c){throw new Error((a&&a.path||"")+": "+c)}}),t}),define("text!templates/discovery-card-course.underscore",[],function(){return'<a href="<%- url %>" class="course-link">\n    <div class="img-wrapper">\n        <img src="<%- image %>" alt="<%- title %>" />\n    </div>\n  <% if ( attributes.course_type === \'credit\' ) { %>\n    <div class="banner">Earn <%- attributes.course_type %></div>\n  <% } else if ( attributes.course_type === \'professional\' ) { %>\n    <div class="banner"><%- attributes.course_type %> Education</div>\n  <% } else if ( attributes.course_type === \'verified\' ) { %>\n    <div class="banner"><%- attributes.course_type %></div>\n  <% } %>\n</a>\n<div class="label">\n    <% if ( organizations.length ) { %>\n        <%- _.pluck(organizations, \'display_name\').join(\', \') %>\n    <% } %>\n</div>\n<div class="course-code">\n    <% if ( attributes.course_number ) { %>\n        <%- attributes.course_number %>\n    <% } %>\n</div>\n<div class="title">\n    <p>\n        <% if ( title ) { %>\n            <%- title %>\n        <% } %>\n    </p>\n</div>\n<div class="availability">\n    <% if ( attributes.availability ) { %>\n        <%- attributes.availability %>\n    <% } %>\n</div>\n<%\n// Hide "Starts:" label if Self-Paced as label doesn\'t make sense\n%>\n<% if ( attributes.start_display_date == "Self-Paced" ) { %>\n    <div class="date"><%- gettext(\'Self-Paced\') %></div>\n<% } else { %>\n    <div class="date"><%- sprintf( gettext(\'Starts: %(date)s\'), {date: attributes.start_display_date} ) %></div>\n<% } %>\n'});var Drupal=Drupal||{t:function(e){return e},formatPlural:function(e,t,i){return 1===e?t:i}},gettext=function(e){return Drupal.t(e)},ungettext=function(e,t,i,n){var r=n?txtUtils.update.replacements(n):{},s=txtUtils.update.strVars(e),o=txtUtils.update.strVars(t);return Drupal.formatPlural(i,s,o,r)},sprintf=function(e,t){var e=txtUtils.update.strVars(e),i=txtUtils.update.replacements(t),n="";return n=Drupal.t(e,i),_.unescape(n)},txtUtils={update:{strVars:function(e){var t,i,n=e.split(" "),r=n.length;for(t=0;r>t;t++)i=n[t],"%("===i.substr(0,2)&&")s"===i.substr(i.length-2)&&(n[t]="@"+i.substr(2,i.length-4));return n.join(" ")},replacements:function(e){var t={};for(var i in e)t["@"+i]=e[i];return t}}};define("gettext",function(){}),define("views/discovery_card_view",["backbone","jquery","underscore","text!../templates/discovery-card-course.underscore","gettext"],function(e,t,i,n){return e.View.extend({tpl:i.template(n),initialize:function(){this.render()},render:function(){return this.$el.html(this.tpl(this.model.toJSON())),this},className:function(){var e=["discovery-card course-card","shadow"],t=this.model.get("attributes").course_type;return t&&e.push(t),e.join(" ")}})}),define("text!templates/discovery-card-xseries.underscore",[],function(){return'  <a href="<%- url %>" class="course-link">\n      <div class="img-wrapper">\n          <img src="<%- image %>" alt="<%- title %>" />\n      </div>\n  </a>\n  <div class="banner"><%- gettext(\'XSeries Program\') %></div>\n<% if ( title ) { %>\n  <div class="title"><%- title %></div>\n<% } %>\n<% if ( subtitle && subtitle.short ) { %>\n  <div class="subtitle"><%- subtitle.short %></div>\n<% } %>\n<% if ( organizations.length ) { %>\n  <div class="label">\n    <%- _.pluck(organizations, \'display_name\').join(\', \') %>\n  </div>\n<% } %>\n<% if ( attributes.availability ) { %>\n  <div class="availability"><%- attributes.availability %></div>\n<% } %>\n'}),define("views/discovery_card_xseries_view",["backbone","jquery","underscore","text!../templates/discovery-card-xseries.underscore","gettext"],function(e,t,i,n){return e.View.extend({tpl:i.template(n),initialize:function(){this.render()},render:function(){return this.$el.html(this.tpl(this.model.toJSON())),this},className:function(){var e=["course-card","discovery-card","xseries","shadow"];return e.join(" ")}})}),define("course_details/models/course_info_model",["backbone"],function(e){return e.Model.extend({urlRoot:"/api/catalog/v2/courses/",initialize:function(e,t){this.url=this.urlRoot+t.courseId}})}),define("course_details/models/course_status_model",["backbone"],function(e){return e.Model.extend({sync:function(t,i,n){return n||(n={}),n.crossDomain||(n.crossDomain=!0),n.xhrFields||(n.xhrFields={withCredentials:!0}),e.sync.apply(this,['"'+t+'"',i,n])},initialize:function(e,t){var i="/api/enrollment/v1/course/";this.flags=t.flags||{},this.url=t.urlRoot+i+t.courseId,this.flags.include_expired&&(this.url+="?include_expired=1")},twoDigits:function(e){return 10>e?"0"+e.toString():e.toString()},formatDate:function(e){var t,i,n,r;return t=new Date(e),i=t.getMonth()+1,n=t.getDate(),r=t.getFullYear(),this.twoDigits(i)+"/"+this.twoDigits(n)+"/"+r},getVerificationExpiration:function(){var e,t,i,n;i=_.findWhere(this.get("course_modes"),{slug:"verified"}),i&&(e=i.expiration_datetime,t=Date.parse(e),n=t<(new Date).getTime(),this.set({verified:{date:this.formatDate(e),expired:n}}))},getCoursePrice:function(){var e=this.get("course_modes"),t=this.getCourseType(),i=_.findWhere(e,{slug:"professional"})||_.findWhere(e,{slug:"no-id-professional"})||_.findWhere(e,{slug:"verified"}),n=!1;return("verified"===t||"credit"===t||"professional"===t||"no-id-professional"===t)&&(n="$"+i.min_price),n},getCourseType:function(){var e=_.pluck(this.get("course_modes"),"slug"),t="honor";return e.indexOf("professional")>-1||e.indexOf("no-id-professional")>-1?t="professional":e.indexOf("credit")>-1?t="credit":e.indexOf("verified")>-1&&(t="verified"),t}})}),function(e){e.cookie=function(t,i,n){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(i))||null===i||void 0===i)){if(n=e.extend({},n),(null===i||void 0===i)&&(n.expires=-1),"number"==typeof n.expires){var r=n.expires,s=n.expires=new Date;s.setDate(s.getDate()+r)}return i=String(i),document.cookie=[encodeURIComponent(t),"=",n.raw?i:encodeURIComponent(i),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}n=i||{};for(var o,a=n.raw?function(e){return e}:decodeURIComponent,l=document.cookie.split("; "),c=0;o=l[c]&&l[c].split("=");c++)if(a(o[0])===t)return a(o[1]||"");return null}}(jQuery),define("jqueryCookie",["jquery"],function(e){return function(){var t;return t||e.jqueryCookie}}(this)),define("course_details/models/enrollment_model",["backbone","jquery","jqueryCookie"],function(e,t){return e.Model.extend({defaults:{course_id:"",optIn:!0},initialize:function(e,t){var i="/api/commerce/v0/baskets/";this.set({course_id:t.courseId,urlRoot:t.urlRoot}),this.url=t.urlRoot+i,this.trackSelectionUrl=t.urlRoot+"/course_modes/choose/",this.dashboardUrl=t.urlRoot+"/dashboard",this.verificationUrlUrl=t.urlRoot+"/verify_student/start-flow/",this.csrfCookieName=this.getCookieName(t.urlRoot),this.auth=t.auth||!1},getCookieName:function(e){var t,i,n,r=e.indexOf("stage")>-1,s=e.indexOf("mobile-stable")>-1,o="prod-edx-csrftoken";return r?o="stage-edx-csrftoken":s?o="mobile-stable-csrftoken":e.indexOf(".sandbox.edx.")>-1&&(t=e.indexOf("://")+3,i=e.indexOf(".sandbox.edx."),n=e.substring(t,i),o=n+"-csrftoken"),o},sync:function(t,i,n){return n=n||{},n.crossDomain||(n.crossDomain=!0),n.xhrFields||(n.xhrFields={withCredentials:!0}),e.sync.apply(this,['"'+t+'"',i,n])},enroll:function(e){var i=this.setHeaders(),n={course_id:this.get("course_id"),email_opt_in:this.get("optIn")};t.ajax({type:"POST",url:this.url,xhrFields:{withCredentials:!0},data:JSON.stringify(n),headers:i,contentType:"application/json; charset=utf-8",crossDomain:!0,context:this,success:function(){this.redirect(e?"honor"===e||"audit"===e?this.dashboardUrl:this.verificationUrl+this.get("course_id")+"/":this.trackSelectionUrl+this.get("course_id"))},error:function(e){var t=JSON.parse(e.responseText);this.redirect(403===e.status&&t.user_message_url?t.user_message_url:this.trackSelectionUrl+this.get("course_id"))}})},redirect:function(e){window.location.href=e},setHeaders:function(){var e={"X-CSRFToken":t.cookie(this.csrfCookieName)},i=this.auth;return i.username&&i.password&&(e.Authorization="Basic "+btoa(i.username+":"+i.password)),e}})}),define("course_details/models/user_model",["backbone","jquery"],function(e,t){return e.Model.extend({defaults:{is_active:!1,is_logged_in:!1,returned:!1},initialize:function(e,t){var i="/api/enrollment/v1/enrollment/";this.url=t.urlRoot+i+t.courseId,this.set({is_active:!1,is_logged_in:!1,returned:!1,silent:!0})},fetch:function(){t.ajax({type:"GET",url:this.url,xhrFields:{withCredentials:!0},contentType:"application/json; charset=utf-8",crossDomain:!0,context:this,success:function(e){this.set(e),this.set({is_logged_in:!0,returned:!0,silent:!0}),this.trigger("sync")},error:function(e){this.set({returned:!0,silent:!0}),this.trigger("error",e)}})}})}),define("course_details/models/enroll_button_model",["backbone"],function(e){return e.Model.extend({defaults:[{action:"",checkbox:!1,classList:[],enrollmentStatus:"",text:"",url:"#"}]})}),define("text!templates/enroll-button.underscore",[],function(){return'<div class="course-header__enroll">\n  <% if ( btn.enrollmentStatus !== \'closed\' && btn.enrollmentStatus !== \'enrolled-started\') { %>\n  <div class="course-start">\n    <% if ( courseStartHeading ) { %>\n      <div><%- courseStartHeading %></div>\n    <% } %>\n    <span><%- courseStart %></span>\n  </div>\n  <% } %>\n  <div class="course-enroll-actions">\n    <a href="<%- btn.url %>" class="btn btn-cta txt-center js-enroll-btn <%- btn.classList %>"><%= btn.text %></a>\n\n    <% if ( btn.checkbox ) { %>\n    <div class="form-field">\n      <label class="register-emails">\n        <input type="checkbox" checked value="true" class="email-opt-in" name="opt-in" />\n        <%= emailOptInText %>\n      </label>\n    </div>\n    <% } %>\n  </div>\n\n</div>\n'}),define("course_details/views/enroll_view",["backbone","jquery","underscore","course_details/models/enroll_button_model","text!../../templates/enroll-button.underscore","gettext"],function(e,t,i,n,r){return e.View.extend({el:"",tpl:i.template(r),events:{"click .email-opt-in":"setOptIn","click .js-enroll-btn":"handleEnroll"},initialize:function(e){var t=e.courseInfo,i=t.get("schools");i&&(this.schools=this.getSchools(i),this.emailOptInText=this.getCheckboxText(this.schools,i.length)),this.courseStatus=e.courseStatus,this.courseType=this.courseStatus.getCourseType(),this.enrollBtn=new n,this.coursePrice=t.get("price"),this.courseStart=t.get("display_start"),this.courseStartHeading=t.get("display_start_heading"),this.courseTitle=t.get("title"),this.courseId=t.get("course_id"),this.flags=t.get("flags")||!1,this.startDate=t.get("start"),this.isWebview=e.isWebview,this.parentEl=e.parentEl,this.courseStatus.getVerificationExpiration(),this.courseStatus.on("change:verified",this.render,this),!this.isWebview&&e.user.get("is_logged_in")?this.checkUser(e.user):(this.enrollBtn.set({action:"register",url:this.initButtonHref()}),this.checkEnrollmentDate())},render:function(){return this.enrollBtn.set({classList:i.uniq(this.enrollBtn.get("classList")).join(" ")}),this.$el.html(this.tpl({btn:this.enrollBtn.toJSON(),secondaryBtnURL:this.setSecondaryBtn(),courseStart:this.courseStart,courseStartHeading:this.courseStartHeading,courseType:this.courseType,flags:this.flags,price:this.getPrice(),emailOptInText:this.emailOptInText,schools:this.schools,type:this.type,verified:this.courseStatus.get("verified")})),this.postRender(),this},postRender:function(){this.$checkbox=this.$el.find(".email-opt-in"),this.$btn=this.$el.find(".js-enroll-btn"),this.model.on("change:optIn",this.syncOptIn,this)},checkCourseModes:function(){var e=i.pluck(this.courseStatus.get("course_modes"),"slug"),t="";t="professional"===this.courseType?this.getButtonText.enrollProfessional():e.length>1?this.getButtonText.enrollMultiple(this):this.getButtonText.enroll(),this.enrollBtn.set({checkbox:!0,text:t}),this.render()},checkEnrollmentDate:function(){var e=new Date,t=this.courseStatus.get("enrollment_start"),i=this.courseStatus.get("enrollment_end"),n=new Date(t),r=new Date(i),s=[];i&&e>r?(s.push("disabled js-enrollment-closed"),this.enrollBtn.set({enrollmentStatus:"closed",text:this.getButtonText.closed(),action:"disabled",thischeckbox:!1,classList:s}),this.render()):t&&n>e?(s.push("disabled js-enrollment-closed"),this.enrollBtn.set({enrollmentStatus:"not-started",text:this.getButtonText.comingSoon(),action:"disabled",checkbox:!1,classList:s}),this.render()):(this.enrollBtn.set({enrollmentStatus:"open"}),this.checkCourseModes())},checkUser:function(e){var t,i=encodeURIComponent(this.courseStatus.get("course_id")),n=new Date,r=new Date(this.startDate),s=this.courseStatus.get("course_start"),o=[],a="",l="",c="";void 0!==s&&(r=null===s?null:new Date(s)),e.get("is_active")===!0?(t=!1,o.push("already-enrolled"),r&&r>n?(a="enrolled-not-started",l=this.getButtonText.enrolledNotOpen(),c=this.model.get("urlRoot")+"/dashboard"):(a="enrolled-started",l=this.getButtonText.enrolled(),c=this.model.get("urlRoot")+"/courses/"+i+"/info"),this.enrollBtn.set({checkbox:t,classList:o,enrollmentStatus:a,text:l,url:c}),this.render()):(this.enrollBtn.set({action:"POST"}),this.checkEnrollmentDate())},getButtonText:{enrolled:function(){return gettext("Open Course")},closed:function(){return gettext("Enrollment is closed")},comingSoon:function(){return gettext("Coming Soon")},enroll:function(){return gettext("Enroll Now")},enrollMultiple:function(){return gettext("Enroll Now")},enrollProfessional:function(){return gettext("Enroll Now")},enrolledNotOpen:function(){return gettext("You Are Enrolled")}},getCheckboxText:function(e,t){return ungettext(gettext("I would like to receive email from %(provider)s and learn about its other programs."),gettext("I would like to receive email from %(provider)s and learn about their other programs."),t,{provider:e})},getPrice:function(){return this.coursePrice?"("+this.coursePrice+")":""},getSchools:function(e){var t,i=e.length,n=e[0].name,r=[];if(2===i)n+=" & "+e[1].name;else if(i>2){for(t=0;i-1>t;t++)r.push(e[t].name);r.push("& "+e[t].name),n=r.join(", ")}return n},handleEnroll:function(e){var i=this.enrollBtn.get("action"),n=this.enrollBtn.get("enrollmentStatus"),r=this.courseStatus.get("course_id"),s=t(e.target),o=!1;s.hasClass("disabled")||("POST"===i&&"open"===n&&(e.preventDefault(),s.attr("disabled",!0).addClass("disabled"),this.model.set("course_id",r),this.flags&&this.flags.course_details_track_selection?(o=t(e.currentTarget).data("type")||!1,this.model.enroll(o)):this.model.enroll()),this.trackEnroll(s))},initButtonHref:function(){var e=this.model.get("urlRoot")+"/register",t="edxapp://enroll",i="?course_id="+encodeURIComponent(this.model.get("course_id")),n="&enrollment_action=enroll",r="&email_opt_in="+!0;return this.isWebview?t+"?course_id="+this.model.get("course_id")+r:e+i+n+r},setButtonHrefOptIn:function(){var e=this.$checkbox.prop("checked"),t=this.$btn.attr("href"),i="&email_opt_in=";this.$btn.attr("href",t.slice(0,t.indexOf(i)+i.length)+e)},setOptIn:function(){this.model.set("optIn",this.$checkbox.prop("checked"))},setSecondaryBtn:function(){return!1},syncOptIn:function(e,t){this.$checkbox.prop("checked")!==t&&this.$checkbox.prop("checked",t),"register"===this.enrollBtn.get("action")&&this.setButtonHrefOptIn()},trackEnroll:function(e){var t="edx.bi.user.course-details.";e.hasClass("js-enrollment-closed")||(t+=e.hasClass("already-enrolled")?"enrolled-user."+this.parentEl:"enroll."+this.parentEl,window.analytics.track(t,{category:"course-details",label:this.courseId}))}})}),define("xseries_details/views/xseries_course_enroll_view",["underscore","course_details/views/enroll_view","jqueryCookie"],function(e,t){return t.extend({trackEnroll:function(e){var t="edx.bi.user.xseries-details.";e.hasClass("js-enrollment-closed")||(t+=e.hasClass("already-enrolled")?"enrolled-user."+this.parentEl:"enroll."+this.parentEl,window.analytics.track(t,{category:"xseries-details",label:this.courseId}))}})}),define("text!templates/discovery-card-course-horizontal.underscore",[],function(){return'<div class="img-wrapper" aria-hidden="true">\n    <a href="<%- url %>">\n        <img src="<%- image %>" alt="<%- title %>">\n    </a>\n</div>\n<div class="details">\n    <div class="title"><a href="<%- url %>"><%- title %></a></div>\n  <% if ( subtitle && subtitle.long ) { %>\n    <div class="subtitle"><%- subtitle.long %></div>\n  <% } else if ( subtitle && subtitle.short ) { %>\n    <div class="subtitle"><%- subtitle.short %></div>\n  <% } %>\n    <a href="<%- url %>">Learn more<span class="sr"> about <%- title %></span></a>\n</div>\n<div class="js-enroll-btn enroll-btn"></div>\n'}),define("views/discovery_card_horizontal_view",["backbone","underscore","course_details/models/course_info_model","course_details/models/course_status_model","course_details/models/enrollment_model","course_details/models/user_model","xseries_details/views/xseries_course_enroll_view","text!../templates/discovery-card-course-horizontal.underscore","gettext"],function(e,t,i,n,r,s,o,a){return e.View.extend({tpl:t.template(a),dependentModels:3,modelsReady:0,initialize:function(e){var t=e.context;this.courseId=this.model.get("attributes").course_id,this.urlRoot=t.urlRoot,this.isWebview=t.isWebview,this.flags=t.flags,this.render(),this.setEnrollModels()},render:function(){return this.$el.html(this.tpl(this.model.toJSON())),this},className:function(){var e=["discovery-card"];return e.join(" ")},setEnrollModels:function(){this.enrollModel=new r({},{courseId:this.courseId,urlRoot:this.urlRoot,auth:{username:!1,password:!1}}),this.userModel=new s({},{courseId:this.courseId,urlRoot:this.urlRoot}),this.userModel.on("sync",this.checkStatus,this),this.userModel.on("error",this.checkStatus,this),this.userModel.fetch(),this.courseInfoModel=new i({},{courseId:this.courseId}),this.courseInfoModel.on("sync",this.checkStatus,this),this.courseInfoModel.fetch(),this.courseStatusModel=new n({},{courseId:this.courseId,urlRoot:this.urlRoot,flags:this.flags}),this.courseStatusModel.on("sync",this.checkStatus,this),this.courseStatusModel.fetch()},addEnrollView:function(){this.enrollView=new o({el:this.$el.find(".js-enroll-btn"),model:this.enrollModel,courseInfo:this.courseInfoModel,courseStatus:this.courseStatusModel,flags:this.flags,isWebview:this.isWebview,parentEl:"discovery-card",user:this.userModel})},checkStatus:function(){this.modelsReady++,this.modelsReady===this.dependentModels&&this.addEnrollView()}})}),define("views/discovery_card_list_view",["backbone","jquery","underscore","models/discovery_card_collection","models/discovery_card_course_run_collection","views/discovery_card_view","views/discovery_card_xseries_view","views/discovery_card_horizontal_view","gettext"],function(e,t,i,n,r,s,o,a){return e.View.extend({el:"",offset:0,cardHeight:360,limit:{min:5,"default":9,max:30},initialize:function(e){var t=this.getCollection(e.cardType);this.el=e.el,this.cardType=e.cardType,this.DiscoveryCardView=this.getCardView(e.orientation),this.queryData=e.queryData,this.context=e.context||{},this.setLimit(this.queryData),this.collection=new t({},{queryData:this.queryData}),this.collection.on("sync",this.render,this),this.collection.fetch()},render:function(){return this.collection.length>0&&this.addCards(),this},addCards:function(){this.collection.each(function(e,t){var i="xseries"===e.get("card_type")?o:this.DiscoveryCardView;this["discovery-card-"+t]=new i({model:e,context:this.context}),this.addToDom(this["discovery-card-"+t].el)},this),this.scrollListener()},addToDom:function(e){this.$el.append(e)},getCardView:function(e){var t=s;return"xseries"===this.cardType?t=o:e&&"landscape"===e&&(t=a),t},getCollection:function(e){return e?(("string"==typeof e||e instanceof String)&&(e=e.split(" ")),e.indexOf("xseries")>-1?n:r):n},scrollListener:function(){var e=t(window);e.off("scroll"),e.on("scroll",this,this.testPosition)},setLimit:function(){var e=this.queryData.limit||!1;(!e||this.limit.min<e||e>this.limit.max)&&(e=this.limit.default),this.queryData.limit=e},testPosition:function(e){var i=e.data,n=i.$el.find(".discovery-card").last();0===n.length&&(n=i.$el.find(".course-card").last()),n.length>0&&i.onScreen(n)&&(t(e.currentTarget).off("scroll"),i.offset+=i.queryData.limit,i.collection.getMore(i.offset))},onScreen:function(e){var i,n=t(window).height(),r=window.pageYOffset?window.pageYOffset:t(window).scrollTop(),s=e.offset().top,o=e.height();return i=s-this.cardHeight,n+r>i&&i>r-o}})}),define("discovery_card_block/views/discovery_card_block_view",["backbone","jquery","underscore","views/discovery_card_list_view","gettext"],function(e,t,i,n){return e.View.extend({el:".js-discovery-card-block",initialize:function(){this.$el.length&&(this.queryData=this.cleanQueryData(this.$el.data()),this.render())},render:function(){this.courseList=new n({el:".js-discovery-card-block",cardType:this.queryData.card_type,orientation:"portrait",queryData:this.queryData})},cleanQueryData:function(e){var t={};return i.each(e,function(e,i){e&&e.toString().length&&(t[i]=this.getQueryAttributes(e))},this),t},getQueryAttributes:function(e){var t=[];return isNaN(e)&&e.indexOf(",")>-1&&(e=e.split(",")),Array.isArray(e)?i.each(e,function(e){var i="";if("string"==typeof e||e instanceof String||isNaN(e))i=e.trim();else try{i=e.node.title}catch(n){i=e.taxonomy_term.uuid}t.push(i)}):t=[e],t}})}),function(){var e={},t={};window.jQuery?define("jquery",[],function(){return window.jQuery}):e.jquery="../vendor/common/jquery-v1.11.2",window._?define("underscore",[],function(){return window._}):e.jquery="../vendor/common/underscore-min",window.Backbone?define("backbone",[],function(){return window.Backbone}):e.backbone="../vendor/common/backbone-min",window.addthis?define("addthis",[],function(){return window.addthis}):e.addthis="../vendor/addthis",t={paths:{addthis:"../vendor/addthis",async:"../async",backbone:"empty",enquire:"../vendor/enquire.min",gettext:"../shim/gettext",jquery:"../vendor/jquery-v1.11.2",jqueryCookie:"../vendor/jquery.cookie",picturefill:"../vendor/picturefill.min",text:"../text",typeahead:"../vendor/typeahead.bundle",underscore:"../vendor/underscore-min"},waitseconds:120,shim:{addthis:{exports:"addthis"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},enquire:{exports:"enquire"},jqueryCookie:{deps:["jquery"],exports:"jqueryCookie"},picturefill:{exports:"picturefill"},typeahead:{deps:["jquery"],exports:"typeahead"},underscore:{exports:"_"}}};for(var i in e)({}).hasOwnProperty.call(e,i)&&(t.paths[i]=e[i]);require.config(t)}(),define("config",function(e){return function(){var t;return t||e.config}}(this)),function(){require(["discovery_card_block/views/discovery_card_block_view","config"],function(e){return new e})}(),define("discovery_card_block/discovery_card_block",function(){});